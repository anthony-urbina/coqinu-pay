(()=>{chrome.tabs.onUpdated.addListener(((e,n,o)=>{"complete"===n.status&&o.url&&function(t){const e=t.url.includes("twitter.com"),n=t.url.includes("x.com");return t.url&&(e||n)&&!function(t){const e=new URL(t).pathname.split("/")[1];return["notifications","explore","home","messages"].includes(e)}(t.url)}(o)&&async function(e,n){const o=function(t){const e=new URL(t).pathname.split("/").filter((t=>t));return e.length>0?e[0]:null}(n);if(o){const n=await t(o);console.log("user:",n);const{twitterUsername:s,walletAddress:r}=n;if(s&&r){console.log("sending message to content script");const t={type:"NEW",username:s,walletAddress:r};chrome.tabs.sendMessage(e,t)}}}(e,o.url)}));const t=async t=>{try{const e=`http://localhost:3000/api/user/get/${t}`;return(await fetch(e)).json()}catch(t){throw console.error(t),t}};chrome.runtime.onMessage.addListener(((t,e,n)=>{console.log("request:",t),"TX_SUCCESS"===t.type&&async function(t){const{from:e,to:n,amount:o,hash:s}=t;console.log("saveTxData",t);try{const t="http://localhost:3000/api/transaction/post";return(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({from:e,to:n,value:Number(o),hash:s})})).json()}catch(t){throw console.error(t),t}}(t)}))})();