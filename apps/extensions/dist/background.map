{"version":3,"file":"background.js","mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://swag/./src/background.js"],"sourcesContent":["chrome.tabs.onUpdated.addListener((tabId, changeInfo, tab) => {\n  if (changeInfo.status === \"complete\" && tab.url && shouldProcessTab(tab)) {\n    handleTabUpdate(tabId, tab.url);\n  }\n});\n\nasync function handleTabUpdate(tabId, url) {\n  const username = extractUsernameFromPath(url);\n  if (username) {\n    const user = await fetchUserFromDirectory(username);\n    console.log(\"user:\", user);\n    const { twitterUsername, walletAddress } = user;\n\n    const userIsInDirectory = twitterUsername && walletAddress;\n    if (userIsInDirectory) {\n      console.log(\"sending message to content script\");\n      const payload = {\n        type: \"NEW\",\n        username: twitterUsername,\n        walletAddress,\n      };\n      chrome.tabs.sendMessage(tabId, payload);\n    }\n  }\n}\n\nfunction shouldProcessTab(tab) {\n  const isTwitterTab = tab.url.includes(\"twitter.com\");\n  const isXTab = tab.url.includes(\"x.com\");\n  return tab.url && (isTwitterTab || isXTab) && !isPathIgnored(tab.url);\n}\n\nfunction isPathIgnored(url) {\n  const ignorePathnames = [\"notifications\", \"explore\", \"home\", \"messages\"];\n  const firstPathPart = new URL(url).pathname.split(\"/\")[1];\n  return ignorePathnames.includes(firstPathPart);\n}\n\nfunction extractUsernameFromPath(url) {\n  const pathname = new URL(url).pathname;\n  const pathParts = pathname.split(\"/\").filter((part) => part);\n  return pathParts.length > 0 ? pathParts[0] : null;\n}\n\nconst fetchUserFromDirectory = async (username) => {\n  try {\n    const url = `https://coqinu-pay-web.vercel.app/api/user/get/${username}`;\n    const response = await fetch(url);\n    return response.json();\n  } catch (err) {\n    console.error(err);\n    throw err;\n  }\n};\n\nchrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\n  console.log(\"request:\", request);\n  if (request.type === \"TX_SUCCESS\") {\n    saveTransaction(request);\n  }\n});\n\nasync function saveTransaction(request) {\n  const { from, to, amount, hash } = request;\n  console.log(\"saveTxData\", request);\n  try {\n    const url = \"https://coqinu-pay-web.vercel.app/api/transaction/post\";\n    const response = await fetch(url, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({ from, to, value: Number(amount), hash }),\n    });\n    return response.json();\n  } catch (err) {\n    console.error(err);\n    throw err;\n  }\n}\n"],"names":[],"sourceRoot":""}